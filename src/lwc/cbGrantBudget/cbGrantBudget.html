<template>

	<!-- SPINNER -->
	<c-cb-spinner show={showSpinner}></c-cb-spinner>
	<!-- SPINNER -->

	<lightning-card title="Grant Budget">

		<lightning-layout>
			<lightning-layout-item>
				<div class="slds-p-top_large">
					<lightning-button label="Add" icon-name="utility:add"
									  onclick={addBudgetLines}></lightning-button>
				</div>
			</lightning-layout-item>
			<lightning-layout-item>
				<lightning-combobox
						name="budgetYear"
						label="Budget Year"
						value={selectedBYId}
						placeholder="Select BY"
						options={budgetYearSO}
						onchange={handleFilter}
						required
				></lightning-combobox>
			</lightning-layout-item>
		</lightning-layout>

		<!-- TOTAL -->
		<lightning-layout class="slds-p-bottom_medium">
			<lightning-layout-item size="3">
				<lightning-input value='TOTAL' label="Label" disabled></lightning-input>
			</lightning-layout-item>
			<lightning-layout-item size="8">
				<lightning-layout horizontal-align="space">
					<template for:each={totalLine.cb5__CBAmounts__r} for:item="amount">
						<lightning-layout-item key={amount}>
							<lightning-input type='number' value={amount.cb5__Value__c}
											 class="dec" disabled
											 formatter="currency"
											 onfocusout={saveAmount}
											 name={amount.Id}
											 label={amount.label}></lightning-input>
						</lightning-layout-item>
					</template>
				</lightning-layout>
			</lightning-layout-item>
			<lightning-layout-item size="1">
				<lightning-input type='number' label="Total" value={totalLine.cb5__Value__c}
								 formatter="currency"
								 class="dec"
								 disabled></lightning-input>
			</lightning-layout-item>

		</lightning-layout>
		<!-- TOTAL -->

		<template for:each={budgetLines} for:item="bl">
			<lightning-layout key={bl.Name}>
				<lightning-layout-item size="2">
					<lightning-input value={bl.Name} label={bl.Id} variant="label-hidden" name="Name"
									 onfocusout={saveBudgetLine}></lightning-input>
				</lightning-layout-item>
				<lightning-layout-item size="1">
					<lightning-combobox
							name="cb5__CBVariable1__c"
							variant="label-hidden"
							label={bl.Id}
							value={bl.cb5__CBVariable1__c}
							placeholder="Select Fund"
							options={fundSO}
							onfocusout={saveBudgetLine}
							required
					></lightning-combobox>
				</lightning-layout-item>
				<lightning-layout-item size="8">
					<lightning-layout horizontal-align="space">
						<template for:each={bl.cb5__CBAmounts__r} for:item="amount">

							<lightning-layout-item key={amount}>
								<lightning-input variant="label-hidden" type='number' value={amount.cb5__Value__c}
												 class="dec"
												 formatter="currency"
												 onfocusout={saveBudgetLine}
												 label={amount.Id}></lightning-input>
							</lightning-layout-item>

						</template>
					</lightning-layout>
				</lightning-layout-item>
				<lightning-layout-item size="1">
					<lightning-input type='number' variant="label-hidden" label="" value={bl.cb5__Value__c}
									 formatter="currency"
									 class="dec"
									 disabled></lightning-input>
				</lightning-layout-item>

			</lightning-layout>

		</template>

	</lightning-card>
</template>